<app-page-breadcrumb
  [pageTitle]="'addNewField'|translate"
  [backUrl]="'/fields'"
></app-page-breadcrumb>

<div class="container-fluid">
  <div class="step_wizard pb-3 px-1 border-bottom mb-3">
    <div class="step_wrapper" [ngClass]="{ active: currentStep == 1 }">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-bezier step_icon"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M0 10.5A1.5 1.5 0 0 1 1.5 9h1A1.5 1.5 0 0 1 4 10.5v1A1.5 1.5 0 0 1 2.5 13h-1A1.5 1.5 0 0 1 0 11.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm10.5.5A1.5 1.5 0 0 1 13.5 9h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM6 4.5A1.5 1.5 0 0 1 7.5 3h1A1.5 1.5 0 0 1 10 4.5v1A1.5 1.5 0 0 1 8.5 7h-1A1.5 1.5 0 0 1 6 5.5v-1zM7.5 4a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z"
        />
        <path
          d="M6 4.5H1.866a1 1 0 1 0 0 1h2.668A6.517 6.517 0 0 0 1.814 9H2.5c.123 0 .244.015.358.043a5.517 5.517 0 0 1 3.185-3.185A1.503 1.503 0 0 1 6 5.5v-1zm3.957 1.358A1.5 1.5 0 0 0 10 5.5v-1h4.134a1 1 0 1 1 0 1h-2.668a6.517 6.517 0 0 1 2.72 3.5H13.5c-.123 0-.243.015-.358.043a5.517 5.517 0 0 0-3.185-3.185z"
        />
      </svg>
      <span class="step_title">{{'landArea'|translate}}</span>
    </div>

    <div class="step_wrapper" [ngClass]="{ active: currentStep == 2 }">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-ui-checks-grid step_icon"
        viewBox="0 0 16 16"
      >
        <path
          d="M2 10h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1zm9-9h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm0 9a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-3zm0-10a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2h-3zM2 9a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H2zm7 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-3a2 2 0 0 1-2-2v-3zM0 2a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm5.354.854a.5.5 0 1 0-.708-.708L3 3.793l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0l2-2z"
        />
      </svg>
      <span class="step_title">{{'fieldDetails'|translate}}</span>
    </div>
  </div>

  <div class="form_wrapper pb-3">
    <div class="map_wrapper text-center" dir="ltr" [hidden]="currentStep != 1">
      <div
        id="map"
        class="mb-2"
        [ngClass]="{
          byDraw: selectedMethod == 1,
          byFile: selectedMethod == 2,
          byWalking: selectedMethod == 3
        }"
      >
      <button class="user_geo_location" (click)="getLocation()">
        <img src="./assets/images/icons/geo_location.svg" alt="">
      </button>
    </div>

      <input
        type="file"
        id="file_input"
        accept=".kml,.zip"
        (change)="fileChanged($event)"
      />
      <label for="file_input" class="upload_btn"
        ><img src="./assets/images/icons/upload.png" alt="" />{{'chooseFile'|translate}}</label
      >

      <div class="w-100 mt-3" dir="rtl">
        <div class="row">
          <div class="col-auto ms-auto ps-1">
            <button
              type="button"
              class="secondary_btn medium_btn"
              (click)="resetAll()"
            >
              {{'changeMethod'|translate}}
            </button>
          </div>
          <div class="col-auto pe-0">
            <button
              class="primary_btn medium_btn px-3"
              [disabled]="!FieldCoordinates"
              (click)="GoToNextStep()"
            >
              {{'saveAndContinue'|translate}}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-arrow-left me-2"
                viewBox="0 0 16 16"
              >
                <path
                  fill-rule="evenodd"
                  d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="detail_form_wrapper" *ngIf="currentStep == 2">
      <form
        class="detail_form"
        [formGroup]="AddFieldForm"
        novalidate
        (ngSubmit)="SaveField()"
        #FormDir="ngForm"
      >
        <div class="container pt-1">
          <div class="row">
            <div class="col-12 col-md-6 mb-4">
              <label
                for="fieldName"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'fieldName'|translate}}</label
              >
              <input
                type="text"
                class="form-control form-control-lg bu_2_text bu_2_text_mobile text-end"
                dir="rtl"
                id="fieldName"
                autocomplete="off"
                formControlName="name"
              />
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted && FormDir.hasError('required', 'name')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>
            <div class="col-12 col-md-6 mb-4">
              <label
                for="fieldArea"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'fieldArea'|translate}}</label
              >
              <input
                type="text"
                class="form-control form-control-lg bu_2_text bu_2_text_mobile text-end"
                dir="rtl"
                id="fieldArea"
                autocomplete="off"
                readonly
                [value]="FieldArea + ' ' + ('hectares'|translate)"
              />
            </div>

            <div class="col-12 col-md-6 mb-4">
              <label
                for="country"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'country'|translate}}</label
              >
              <select (change)="LoadProvincesList()"
                formControlName="countryId"
                class="form-control form-control-lg bu_2_text bu_2_text_mobile"
                id="country"
              >
                <option [ngValue]="country.id" *ngFor="let country of CountriesList">{{country.title}}</option>
              </select>
            </div>

            <div class="col-12 col-md-6 mb-4">
              <label
                for="provinec"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'province'|translate}}</label
              >
              <select
                class="form-control form-control-lg bu_2_text bu_2_text_mobile"
                id="provinec"
                formControlName="provinceId"
              >
                <option [ngValue]="province.id" *ngFor="let province of ProvincesList">{{province.title}}</option>
              </select>
            </div>

            <div class="col-12 col-md-6 mb-4">
              <label class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'currentProductName'|translate}}</label
              >
              <select
                class="form-control form-control-lg bu_2_text bu_2_text_mobile"
                formControlName="fieldProductId"
              >
                <option
                  [ngValue]="item.id"
                  *ngFor="let item of FieldProductsList"
                >
                  {{ item.title }}
                </option>
              </select>
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'fieldProductId')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>


            <div class="col-12 col-md-6 mb-4">
              <label
                for="cultivationDate"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'currentProductCultivationDate'|translate}}</label
              >
              <div class="input-group" dir="ltr">
                <input
                  id="cultivationDate"
                  class="form-control"
                  placeholder="yyyy-mm-dd"
                  readonly
                  [minDate]="harvestDate"
                  [placement]="'bottom'"
                  [firstDayOfWeek]="translateService.calendarType==='Shamsi'?6:1"
                  [ngModelOptions]="{ standalone: true }"
                  name="dp"
                  ngbDatepicker
                  #d1="ngbDatepicker"
                  [(ngModel)]="cultivationDate"
                  (dateSelect)="setDate('cultivationDate')"
                />
                <button
                  class="btn btn-outline-secondary calendar"
                  (click)="d1.toggle()"
                  type="button"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="23"
                    height="23"
                    fill="#383440"
                    class="bi bi-calendar4-week"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z"
                    />
                    <path
                      d="M11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"
                    />
                  </svg>
                </button>
              </div>
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'cultivationDate')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>

            <div class="col-12 col-md-6 mb-4">
              <label class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'pastProductName'|translate}}</label
              >
              <select
                class="form-control form-control-lg bu_2_text bu_2_text_mobile"
                formControlName="previousFieldProductId"
              >
                <option
                  [ngValue]="item.id"
                  *ngFor="let item of FieldProductsList"
                >
                  {{ item.title }}
                </option>
              </select>
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'previousFieldProductId')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>

            <div class="col-12 col-md-6 mb-4">
              <label
                for="harvestDate"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'pastProductHarvestDate'|translate}}</label
              >
              <div class="input-group" dir="ltr">
                <input
                  id="harvestDate"
                  class="form-control"
                  placeholder="yyyy-mm-dd"
                  readonly
                  [maxDate]="cultivationDate"
                  [placement]="'bottom'"
                  [firstDayOfWeek]="translateService.calendarType==='Shamsi'?6:1"
                  [ngModelOptions]="{ standalone: true }"
                  name="dp"
                  ngbDatepicker
                  #d2="ngbDatepicker"
                  [(ngModel)]="harvestDate"
                  (dateSelect)="setDate('harvestDate')"
                />
                <button
                  class="btn btn-outline-secondary calendar"
                  (click)="d2.toggle()"
                  type="button"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="23"
                    height="23"
                    fill="#383440"
                    class="bi bi-calendar4-week"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z"
                    />
                    <path
                      d="M11 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"
                    />
                  </svg>
                </button>
              </div>
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'harvestDate')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>



            <div class="col-12 col-md-6 mb-4">
              <label class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'irrigationMethod'|translate}}</label
              >
              <select
                class="form-control form-control-lg bu_2_text bu_2_text_mobile"
                formControlName="irrigationType"
                (change)="irrigationTypeChange()"
              >
                <option
                  [ngValue]="item.id"
                  *ngFor="let item of IrrigationType"
                >
                  {{ item.title }}
                </option>
              </select>
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'irrigationType')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>

            <div class="col-12 col-md-6 mb-4" *ngIf="AddFieldForm.value.irrigationType != IrrigationTypes.Rainfed">
              <label
                for="irrigationPeriod"
                class="bu_1_text bu_1_text_mobile Dark_70_text mb-1"
                >{{'irrigationPeriod'|translate}} <small>({{'everyFewDays'|translate}})</small></label
              >
              <input
                type="text"
                class="form-control form-control-lg bu_2_text bu_2_text_mobile text-end"
                dir="rtl"
                id="irrigationPeriod"
                autocomplete="off"
                formControlName="irrigationPeriod"
              />
              <small
                class="text-danger"
                *ngIf="
                  FormDir.submitted &&
                  FormDir.hasError('required', 'irrigationPeriod')
                "
                >{{'fieldRequiredErrorMessage'|translate}}</small
              >
            </div>

            <div class="col-12 mx-auto mb-4 row">
              <div class="col-6 col-md-3 ps-1 pe-0">
                <button
                  type="button"
                  class="secondary_btn medium_btn w-100"
                  (click)="currentStep = 1"
                >
                  {{'previousStep'|translate}}
                </button>
              </div>
              <div class="col-6 col-md-3 ps-0 pe-1 me-auto">
                <button type="submit" class="primary_btn medium_btn px-1 w-100">
                  {{'saveField'|translate}}
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<ng-template #methodModal let-modal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h6 class="modal-title" id="modal-basic-title">{{'chooseMethod'|translate}}</h6>
    <button
      type="button"
      class="btn-close me-auto ms-0"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <div class="draw_methods py-3 px-4">
      <div class="title heading_level_4 heading_level_4_mobile text-center">
        {{'fieldSelectChooseMethod'|translate}}
      </div>
      <div class="methods_wrapper">
        <button
          class="bd_2_etr1_text bd_2_etr1_text_mobile"
          id="polygon_method"
          (click)="choaseMethodModal(1)"
        >
          <img src="./assets/images/icons/drawing.png" alt="" />
          {{'drawPolygon'|translate}}
        </button>
        <button
          class="bd_2_etr1_text bd_2_etr1_text_mobile"
          id="file_method"
          (click)="choaseMethodModal(2)"
        >
          <img src="./assets/images/icons/upload.png" alt="" />
          {{'uploadFieldFile'|translate}}
          <span>( KML , SHP )</span>
        </button>
        <button
          class="bd_2_etr1_text bd_2_etr1_text_mobile"
          id="walking_method"
          (click)="choaseMethodModal(3)"
          disabled
        >
          <img src="./assets/images/icons/walking.png" alt="" />
          {{'walkingAroundField'|translate}}
        </button>
      </div>
    </div>
  </div>
</ng-template>
